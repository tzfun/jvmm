repositories {
    mavenCentral()
}

dependencies {
    compile(project(':convey'))
    compile(project(':core'))
    compile("commons-cli:commons-cli:${commonsCli}")
}

jar {
    manifestContentCharset 'utf-8'
    metadataCharset 'utf-8'

    def jarName = "jvmm-client.jar"
    archiveName(jarName)
    manifest {
        attributes 'Main-Class': 'org.beifengtz.jvmm.client.ClientApplication'
    }

    from {
        configurations.compile.collect { it.isDirectory() ? it : zipTree(it) }
    }

    doLast {
        def targetDir = "${rootProject.rootDir}/bin/jvmm-${rootProject.version}"
        copy {
            println("copy ${jarName} to ${targetDir}")
            from "${project.buildDir}/libs/${jarName}", "${project.buildDir}/resources/main/attach", "${project.buildDir}/resources/main/attach.bat"
            into targetDir
        }
    }
}